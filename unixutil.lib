# unixutil.lib

# Universal methods and variables

FRC_YEAR=(cut -d' ' -f4 <<< $now) # Gets the current year

VSCODE_CURL_LINK="https://go.microsoft.com/fwlink/?LinkID=620882"
VSCODE_CURL_ZIP_FILE="index.html?LinkID=620882"
VSCODE_INSTALL_PATH="$HOME/Applications"

WPILIB_CURL_LINK="https://github.com/wpilibsuite/allwpilib/releases/download/v2019.4.1/WPILib_Mac-2019.4.1.tar.gz"
WPILIB_CURL_ZIP_FILE="WPILib_Mac-2019.4.1.tar.gz"
WPILIB_INSTALL_PATH="$HOME/frc$FRC_YEAR"

NAVX_CURL_LINK="http://www.kauailabs.com/public_files/navx-mxp/navx-mxp-libs.zip"
NAVX_CURL_ZIP_FILE="navx-mxp-libs.zip"
NAVX_INSTALL_PATH="$WPILIB_INSTALL_PATH/NavX"

CTRE_CURL_LINK="http://www.ctr-electronics.com//downloads/lib/CTRE_FRCLibs_NON-WINDOWS_v4.4.1.10.zip"
CTRE_CURL_ZIP_FILE="CTRE_FRCLibs_NON-WINDOWS_v4.4.1.10.zip"
CTRE_INSTALL_PATH="$WPILIB_INSTALL_PATH/CTRE"

JAVA_HOME="$HOME/frc$FRC_YEAR/jdk"

vscodeExtensionInstallation()
{
    case $1 in
        macOS)
            cat <<EOF >> ~/.profile
                export PATH="\$PATH:/Applications/Visual Studio Code.app/Contents/Reources/app/bin"
            EOF
            ;;
  cd $WPILIB_INSTALL_PATH/vsCodeExtensions
  code --install-extension Cpp.vsix
  code --install-extension JavaLang.vsix
  code --install-extension JavaDeps.vsix
  code --install-extension JavaDebug.vsix
  code --install-extension WPILib.vsix
}

# macOS only methods

homebrewInstallation()
{
    /usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
}

vscodeLinkInstallation()
{
    wget -c $VSCODE_WGET_LINK
    unzip $VSCODE_WGET_ZIP_FILE -d $VSCODE_INSTALL_PATH
    rm -f $VSCODE_WGET_ZIP_FILE
}

yarnInstallation()
{
    # install nvm in order to get a new enough version of node.js
    curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.33.8/install.sh | bash
    export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"  # This loads nvm
[ -s "$NVM_DIR/bash_completion" ] && \. "$NVM_DIR/bash_completion"  # This loads nvm bash_completion
    nvm install 10
    case $1 in
        macOS)
            brew install yarn
            ;;
        arch)
            sudo pacman -S yarn
            ;;
        ubuntu)
            curl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | sudo apt-key add -
            echo "deb https://dl.yarnpkg.com/debian/ stable main" | sudo tee /etc/apt/sources.list.d/yarn.list
            sudo apt-get update && sudo apt-get install yarn
}

# Unix Only Methods

vscodeInstallation()
{
    snapInstallation
    snap install code --classic
    vscodeExtensionInstallation
}
